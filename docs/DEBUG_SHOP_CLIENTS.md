# –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã "–ú–æ–∏ –º–∞–≥–∞–∑–∏–Ω—ã" –ø—É—Å—Ç—ã–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ö–ª–∏–µ–Ω—Ç –Ω–µ –≤–∏–¥–∏—Ç –º–∞–≥–∞–∑–∏–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–∏ –º–∞–≥–∞–∑–∏–Ω—ã", —Ö–æ—Ç—è –º–∞–≥–∞–∑–∏–Ω –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –∫–ª–∏–µ–Ω—Ç–∞.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –∞–∫–∫–∞—É–Ω—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–æ–º–µ—Ä–æ–º, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –º–∞–≥–∞–∑–∏–Ω –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∞–≥–∞–∑–∏–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–æ—Ç –∂–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
- –ù–æ–º–µ—Ä–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—É–±–∏—Ä–∞—é—Ç—Å—è –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å—ã), –Ω–æ —Ñ–æ—Ä–º–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º

**–ü—Ä–∏–º–µ—Ä:**
- –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: `+992 90 123 45 67`
- –í –º–∞–≥–∞–∑–∏–Ω–µ: `+992901234567`
- –û–±–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –≤: `+992901234567` ‚úÖ

### 2. –ö–ª–∏–µ–Ω—Ç –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –º–∞–≥–∞–∑–∏–Ω–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∞–≥–∞–∑–∏–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ API:
   ```
   POST /api/v1/shop/customers/register
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç API - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `success: true`

### 3. –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ó–∞–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É–∫–∞–∑–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω

## –û—Ç–ª–∞–¥–∫–∞ —á–µ—Ä–µ–∑ –ª–æ–≥–∏

–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ –∏—â–∏—Ç–µ –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[GetMyShops]`:

```
üîç [GetMyShops] –ü–æ–∏—Å–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: userID=..., phone=..., normalizedPhone=...
üìã [GetMyShops] –ù–∞–π–¥–µ–Ω–æ –º–∞–≥–∞–∑–∏–Ω–æ–≤: X –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ...
```

–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ 0 –º–∞–≥–∞–∑–∏–Ω–æ–≤, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ö–∞–∫–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–∞–∫–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –º–∞–≥–∞–∑–∏–Ω –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```sql
SELECT id, name, phone, email FROM users WHERE id = 'user_id_here';
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –º–∞–≥–∞–∑–∏–Ω–∞:
```sql
SELECT id, shop_id, phone, qr_code, bonus_amount, user_id 
FROM shop_clients 
WHERE shop_id = 'shop_id_here';
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
```sql
SELECT sc.*, s.name as shop_name 
FROM shop_clients sc
JOIN shops s ON s.id = sc.shop_id
WHERE sc.phone = '+992901234567';  -- –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
```

### –ù–∞–π—Ç–∏ –≤—Å–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –≤ shop_clients:
```sql
SELECT DISTINCT phone FROM shop_clients;
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–æ–º–µ—Ä–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö

**–°–∏–º–ø—Ç–æ–º:** –í –ë–î –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ ShopClient, –Ω–æ –æ–Ω–∏ –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ –Ω–æ–º–µ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –º–∞–≥–∞–∑–∏–Ω–æ–º –Ω–æ–º–µ—Ä –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –Ω–æ–º–µ—Ä–∞, –Ω–æ –µ—Å–ª–∏ –≤ –ë–î —É–∂–µ –µ—Å—Ç—å –Ω–æ–º–µ—Ä–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö, –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –º–∏–≥—Ä–∞—Ü–∏—è.

**–ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –Ω–æ–º–µ—Ä–æ–≤:**
```sql
-- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –Ω–æ–º–µ—Ä–∞ –≤ shop_clients (–ø—Ä–∏–º–µ—Ä –¥–ª—è PostgreSQL)
-- –í–Ω–∏–º–∞–Ω–∏–µ: –°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø!

UPDATE shop_clients 
SET phone = regexp_replace(regexp_replace(phone, '[^0-9+]', '', 'g'), '^\+?', '+', 'g')
WHERE phone ~ '[^0-9+]';
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–ª–∏–µ–Ω—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ –Ω–µ —Å–≤—è–∑–∞–Ω —Å User

**–°–∏–º–ø—Ç–æ–º:** –í shop_clients –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏, –Ω–æ user_id = NULL.

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ `GET /shops/my` —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∂–µ—Ç –∑–∞–ø–∏—Å–∏ ShopClient —Å –∞–∫–∫–∞—É–Ω—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –º–∞–≥–∞–∑–∏–Ω:
```bash
curl -X POST https://your-domain.com/api/v1/shop/customers/register \
  -H "Content-Type: application/json" \
  -d '{
    "shopId": "your-shop-id",
    "phone": "+992 90 123 45 67",
    "qrCode": "TEST-QR-001",
    "bonusAmount": 100
  }'
```

### 2. –í–æ–π—Ç–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ç–µ–º –∂–µ –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞

### 3. –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤:
```bash
curl -X GET https://your-domain.com/api/v1/shops/my \
  -H "Authorization: Bearer your-jwt-token"
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç:
- –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –º–∞—Å—Å–∏–≤ —Å –º–∞–≥–∞–∑–∏–Ω–∞–º–∏
- –ï—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
1. –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∫–∞–∑–∞–Ω –≤ –ø—Ä–æ—Ñ–∏–ª–µ
2. –ú–∞–≥–∞–∑–∏–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª –∫–ª–∏–µ–Ω—Ç–∞
3. –ù–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ —Å–æ–≤–ø–∞–¥–∞—é—Ç (—Å —É—á–µ—Ç–æ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏)

