// ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–ò =====

const CONFIG = {
  // === API –ù–ê–°–¢–†–û–ô–ö–ò ===
  API: {
    // –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    DEV_BASE_URL: 'http://localhost:8080',

    // –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ ‚Äî –ø—É—Å—Ç–æ, —á—Ç–æ–±—ã —Ö–æ–¥–∏—Ç—å –Ω–∞ —Ç–æ—Ç –∂–µ —Ö–æ—Å—Ç (same-origin)
    PROD_BASE_URL: '',

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä URL
    get BASE_URL() {
      return (location.hostname === 'localhost' || location.hostname === '127.0.0.1')
        ? this.DEV_BASE_URL
        : this.PROD_BASE_URL; // –≤ –ø—Ä–æ–¥–µ –¥–∞—Å—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ /api/... /images/...
    },

    // –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API
    ENDPOINTS: {
      AUTH: {
        LOGIN: '/api/v1/auth/login',
        PROFILE: '/api/v1/users/profile',
      },
      PRODUCTS: {
        LIST: '/api/v1/products/',
        SHOP_LIST: '/api/v1/shop/products/',
        CREATE: '/api/v1/shop/products/',
        UPDATE: (id) => `/api/v1/shop/products/${id}`,
        DELETE: (id) => `/api/v1/shop/products/${id}`,
        GET:    (id) => `/api/v1/products/${id}`,
      },
      CATEGORIES: {
        LIST: '/api/v1/categories/',
        CREATE: '/api/v1/admin/categories/',
        UPDATE: (id) => `/api/v1/admin/categories/${id}`,
        DELETE: (id) => `/api/v1/admin/categories/${id}`,
        GET:    (id) => `/api/v1/categories/${id}`,
      },
      USERS: {
        LIST: '/api/v1/admin/users/',
        CREATE: '/api/v1/admin/users/',
        UPDATE: (id) => `/api/v1/admin/users/${id}`,
        DELETE: (id) => `/api/v1/admin/users/${id}`,
        GET:    (id) => `/api/v1/admin/users/${id}`,
      },
      ROLES: {
        LIST: '/api/v1/admin/roles/',
        CREATE: '/api/v1/admin/roles/',
        UPDATE: (id) => `/api/v1/admin/roles/${id}`,
        DELETE: (id) => `/api/v1/admin/roles/${id}`,
        GET:    (id) => `/api/v1/admin/roles/${id}`,
      },
      ORDERS: {
        LIST: '/api/v1/admin/orders', // –µ—Å–ª–∏ —É –±—ç–∫–∞ –Ω—É–∂–µ–Ω –∫–æ–Ω–µ—á–Ω—ã–π —Å–ª—ç—à ‚Äî –ø–æ—Å—Ç–∞–≤—å '/'
        SHOP_LIST: '/api/v1/shop/orders/',
      },
      UPLOAD: {
        IMAGE: '/api/v1/upload/image',
        DELETE_IMAGE: (filename) => `/api/v1/upload/image/${filename}`,
      },
      HEALTH: '/api/health',
    },
  },

  // === –ù–ê–°–¢–†–û–ô–ö–ò –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô ===
  IMAGES: {
    FOLDERS: {
      PRODUCTS: 'products',
      VARIATIONS: 'variations',
      CATEGORIES: 'categories',
      USERS: 'users',
    },
    MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
    ALLOWED_TYPES: ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'],
    IP_REPLACEMENTS: { // –æ—Å—Ç–∞–≤–∏–º –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π; –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ getImageUrl
      '0.0.0.0': 'localhost',
      '127.0.0.1': 'localhost',
    },
  },

  // === –ù–ê–°–¢–†–û–ô–ö–ò –°–ï–°–°–ò–ò ===
  SESSION: {
    TOKEN_LIFETIME: 24 * 60 * 60 * 1000, // 24 —á–∞—Å–∞
    STORAGE_KEYS: {
      TOKEN: 'adminToken',
      USER_ROLE: 'userRole',
      USER_DATA: 'userData',
      LAST_ACTIVITY: 'lastActivity',
      API_URL: 'api_url',
    },
  },

  // === –ù–ê–°–¢–†–û–ô–ö–ò UI ===
  UI: {
    ANIMATION_DELAYS: { TAB_SWITCH: 150, DATA_LOAD: 100, PRODUCTS_LOAD: 200 },
    MOBILE: { MIN_BUTTON_SIZE: 44, FONT_SIZE: 16 },
  },

  // === –ù–ê–°–¢–†–û–ô–ö–ò –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø ===
  LOGGING: {
    ENABLED: true,
    LEVELS: { ERROR:'‚ùå', WARNING:'‚ö†Ô∏è', INFO:'‚ÑπÔ∏è', SUCCESS:'‚úÖ', DEBUG:'üîç' },
  },
};

// ===== –£–¢–ò–õ–ò–¢–´ =====

// –ü–æ–ª–Ω—ã–π URL –¥–ª—è API
function getApiUrl(endpoint) {
  return CONFIG.API.BASE_URL + endpoint;
}

// –ö–∞—Ä—Ç–∏–Ω–∫–∞: –í–°–ï–ì–î–ê same-origin
function getImageUrl(url) {
  if (!url) return '';

  // 1) –ï—Å–ª–∏ API –≤–µ—Ä–Ω—É–ª –ø–æ–ª–Ω—ã–π URL –∫ /images/ ‚Äî –¥–µ–ª–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º
  const m = url.match(/^https?:\/\/[^/]+(\/images\/.+)$/i);
  if (m) return m[1]; // -> "/images/variations/.."

  // 2) –ò–Ω–∞—á–µ ‚Äî –∫–∞–∫ —Ä–∞–Ω—å—à–µ: –¥–æ–±–∞–≤–∏–º BASE_URL –ø—Ä–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º –ø—É—Ç–∏
  if (!url.startsWith('http')) {
    return (url.startsWith('/') ? CONFIG.API.BASE_URL + url
                                : CONFIG.API.BASE_URL + '/' + url);
  }

  // 3) –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π: –∑–∞–º–µ–Ω—ã ¬´–ø–ª–æ—Ö–∏—Ö¬ª —Ö–æ—Å—Ç–æ–≤
  let imageUrl = url;
  const REPL = {
    'http://0.0.0.0:8080': '',
    'http://127.0.0.1:8080': '',
    'http://localhost:8080': '',
    'http://localhost': '',
  };
  Object.entries(REPL).forEach(([from, to]) => {
    if (imageUrl.startsWith(from + '/images/')) imageUrl = imageUrl.replace(from, '');
  });

  return imageUrl;
}
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
function log(level, message, data = null) {
  if (!CONFIG.LOGGING.ENABLED) return;
  const prefix = CONFIG.LOGGING.LEVELS[level] || '‚ÑπÔ∏è';
  const timestamp = new Date().toLocaleTimeString();
  data ? console.log(`${prefix} [${timestamp}] ${message}`, data)
       : console.log(`${prefix} [${timestamp}] ${message}`);
}

// –≠–∫—Å–ø–æ—Ä—Ç
window.CONFIG = CONFIG;
window.getApiUrl = getApiUrl;
window.getImageUrl = getImageUrl;
window.log = log;

// –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –ª–æ–≥
log('INFO', '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', {
  baseUrl: CONFIG.API.BASE_URL,
  environment: (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? 'development' : 'production',
});

